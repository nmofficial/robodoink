<!DOCTYPE html>
<html>

<head>
  <title> Robodoink </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" type="text/css" href="style1.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
</head>

<body onload="startGame()">
  <h1>
    Robodoink
  </h1>
  <div>
  </div>

  <p>
    When in doubt,
  </p>
  <p>
    doink it out!
  </p>

</body>

<script>

var myDoinker, myVegetableOne, myVegetableTwo, myScore;
var rightDown = false;
var leftDown = false;
var upDown = false;

var canPressUp = true;
var canPressUpInter = true;

function startGame() {
  myGameArea.start();
  myDoinker = new component(10, "#ff9900", 100, 260);
  myVegetableOne = new component(15, "green", 120, 250);
  myVegetableTwo = new component(14, "#FFE4C4", 300, 256);
  myScore = new component("30px", "blue", 20, 40, "Arial", "text");
}

window.onkeydown = function(e) {
  // window.addEventListener('keydown', function (e) {
  if (e.keyCode == 65) leftDown = true;
  if (e.keyCode == 68) rightDown = true;
  if ((e.keyCode == 87) && (myDoinker.y >= 10)) upDown = true;
}

window.onkeyup = function(e) {
  // window.addEventListener('keyup', function (e) {
  if (e.keyCode == 65) leftDown = false;
  if (e.keyCode == 68) rightDown = false;
  if (e.keyCode == 87) {
    upDown = false;
    canPressUp = true;
  }
}

function gravity() {

}

var myGameArea = {
  canvas : document.createElement("canvas"),
  start : function() {
    this.canvas.width = 480;
    this.canvas.height = 270;
    this.context = this.canvas.getContext("2d");
    document.body.insertBefore(this.canvas, document.body.childNodes[0]);
    this.frameNumber = 0;
    this.interval = setInterval(updateGameArea, 5);
  },
  clear : function(){
    this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
  }
}

function component(radius, color, x, y, extra, type) {
  this.type = type;
  this.width = radius;
  this.speedX = 0;
  this.speedY = 0;
  this.x = x;
  this.y = y;
  this.extra = extra;
  var randomDirection = Math.random()*2;
  if (randomDirection < 1) {this.vegetableDirection = 1; }
  else {this.vegetableDirection = -1; }

  this.update = function() {

    ctx = myGameArea.context;

    if (this.type == "text") {
      ctx.font = this.width + " " + this.extra;
      ctx.fillStyle = color;
      ctx.fillText(this.text, this.x, this.y);
    } else {
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.width, 0, Math.PI*2);
      ctx.fillStyle = color;
      ctx.fill();
    }
  }
  this.newPosition = function() {
    this.x += this.speedX;
    this.y += this.speedY;
  }
}

//set intial speed for X and Y. Y won't reset so gravity will work.
myDoinker.speedX = 0;
myDoinker.speedY = 0;

function updateGameArea() {
  myGameArea.clear();
  myGameArea.frameNumber ++;
  myDoinker.speedX = 0;

  if (myDoinker.x >= myGameArea.canvas.width - 10) {rightDown = false;}
  if (myDoinker.x <= 10) {leftDown = false;}


  if (leftDown) {myDoinker.speedX = -.75; }
  if (rightDown) {myDoinker.speedX = .75; }

  if (upDown) {
    if (canPressUp && canPressUpInter) myDoinker.speedY = -1.85;
    canPressUp = false;
    canPressUpInter = false;
  }


  //gravity
  if (myDoinker.y < 260) {
    myDoinker.speedY += 0.035;
  } else if (myDoinker.y > 260){
    myDoinker.y = 260;
    myDoinker.speedY = 0;
  } else if (myDoinker.y >= 260) {
    canPressUpInter = true;
  }

  //for testing purposes:
  console.log(myGameArea.frameNumber);
  console.log(myDoinker.y);
  console.log(myDoinker.speedY);

  myDoinker.newPosition();
  myDoinker.update();

  if ((myVegetableOne.x >= myGameArea.canvas.width - 10) || myVegetableOne.x <= 10) {myVegetableOne.vegetableDirection = myVegetableOne.vegetableDirection * -1;}
  if (myVegetableOne.vegetableDirection == 1) {myVegetableOne.speedX = .3;}
  else {myVegetableOne.speedX = -.3;}
  myVegetableOne.newPosition();
  myVegetableOne.update();

  if ((myVegetableTwo.x >= myGameArea.canvas.width - 10) || myVegetableTwo.x <= 10) {myVegetableTwo.vegetableDirection = myVegetableTwo.vegetableDirection * -1;}
  if (myVegetableTwo.vegetableDirection == 1) {myVegetableTwo.speedX = .3;}
  else {myVegetableTwo.speedX = -.3;}
  myVegetableTwo.newPosition();
  myVegetableTwo.update();

  myScore.text = "SCORE: ";
  myScore.update();
}

</script>
</html>
